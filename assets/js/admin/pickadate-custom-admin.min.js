!function(e){e(document).ready(function(){e("#woocommerce-order-items").on("click","a.edit-order-item",function(){var t=e(this).closest("tr").find(".datepicker"),a=e(this).closest("tr").find(".variation_id");if(t.length&&a.length){$input=t.pickadate({close:"",formatSubmit:"yyyy-mm-dd"}),setStartOnLoad=!1,setEndOnLoad=!1;var o=a.data("item_id"),n=e(".datepicker_start--"+o).pickadate(),i=e(".datepicker_end--"+o).pickadate(),d=($input.pickadate("picker"),n.pickadate("picker")),r=i.pickadate("picker");setStart=e(".datepicker_start--"+o).data("value"),setEnd=e(".datepicker_end--"+o).data("value"),d.on({set:function(e){"undefined"!=typeof e.clear&&null==e.clear?(r.set("disable",!1,{muted:!0}).set("max",!1,{muted:!0}).set("highlight",new Date,{muted:!0}),startPick=void 0,ebs_clear_booking_session()):startPick=e.select,e.select&&"undefined"!=typeof e.select&&(startPickerData={startDate:d.get("select","yyyy-mm-dd"),disabledDate:d.get("select"),startDateDisplay:d.get("select","dd mmmm yyyy")},r.set("disable",!1,{muted:!0}),"days"==order_ajax_info.calc_mode?r.set("disable",[{from:!0,to:[startPickerData.disabledDate.year,startPickerData.disabledDate.month,startPickerData.disabledDate.date-1]}],{muted:!0}):r.set("disable",[{from:!0,to:[startPickerData.disabledDate.year,startPickerData.disabledDate.month,startPickerData.disabledDate.date]}],{muted:!0}),""==setStart&&(setStartOnLoad=!0),"undefined"!=typeof startPick&&"undefined"!=typeof endPick&&1==setStartOnLoad&&1==setEndOnLoad&&ebs_set_price(o,startPickerData,endPickerData),""!=setStart&&(setStartOnLoad=!0))}}),r.on({set:function(e){"undefined"!=typeof e.clear&&null==e.clear?(d.set("disable",!1,{muted:!0}).set("max",!1,{muted:!0}).set("highlight",new Date,{muted:!0}),endPick=void 0,ebs_clear_booking_session()):endPick=e.select,e.select&&"undefined"!=typeof e.select&&(endPickerData={endDate:r.get("select","yyyy-mm-dd"),disabledEndDate:r.get("select"),endDateDisplay:r.get("select","dd mmmm yyyy")},"days"==order_ajax_info.calc_mode?d.set("max",[endPickerData.disabledEndDate.year,endPickerData.disabledEndDate.month,endPickerData.disabledEndDate.date],{muted:!0}):d.set("max",[endPickerData.disabledEndDate.year,endPickerData.disabledEndDate.month,endPickerData.disabledEndDate.date-1],{muted:!0}),""==setEnd&&(setEndOnLoad=!0),"undefined"!=typeof startPick&&"undefined"!=typeof endPick&&1==setStartOnLoad&&1==setEndOnLoad&&ebs_set_price(o,startPickerData,endPickerData),""!=setEnd&&(setEndOnLoad=!0))}}),ebs_clear_booking_session=function(){var t={action:"clear_booking_session"};e.post(order_ajax_info.ajax_url,t)},ebs_set_price=function(t,a,o){var n=e('.quantity[name="order_item_qty['+t+']"]'),i=n.val(),d=n.attr("data-qty"),r={action:"ebs_sku_order_update_product_dates",order_id:order_ajax_info.order_id,item_id:t,quantity:i,start:a.startDateDisplay,end:o.endDateDisplay,start_format:a.startDate,end_format:o.endDate};e(".item[data-order_item_id="+t+"]").fadeTo("400","0.6").block({message:null,overlayCSS:{background:"transparent url("+woocommerce_admin_meta_boxes.plugin_url+"/assets/images/ajax-loader.gif) no-repeat center",backgroundSize:"16px 16px",opacity:.6}}),e.post(order_ajax_info.ajax_url,r,function(a){var o=e('.line_total[name="line_total['+t+']"]'),n=e('.line_subtotal[name="line_subtotal['+t+']"]'),r=e('.line_tax[name="line_tax['+t+'][1]"]'),c=e('.line_subtotal_tax[name="line_subtotal_tax['+t+'][1]"]'),s=accounting.unformat(a.total,woocommerce_admin.mon_decimal_point),m=accounting.unformat(s/d,woocommerce_admin.mon_decimal_point);o.val(parseFloat(accounting.formatNumber(m*i,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point));var _=accounting.unformat(a.subtotal,woocommerce_admin.mon_decimal_point),l=accounting.unformat(_/d,woocommerce_admin.mon_decimal_point);if(n.val(parseFloat(accounting.formatNumber(l*i,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point)),a.tax_total&&"undefined"!=typeof a.tax_total){var u=accounting.unformat(a.tax_total[1],woocommerce_admin.mon_decimal_point),p=accounting.unformat(u/d,woocommerce_admin.mon_decimal_point);p>0&&r.val(parseFloat(accounting.formatNumber(p*i,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point))}if(a.tax_subtotal&&"undefined"!=typeof a.tax_subtotal){var f=accounting.unformat(a.tax_subtotal[1],woocommerce_admin.mon_decimal_point),b=accounting.unformat(f/d,woocommerce_admin.mon_decimal_point);b>0&&c.val(parseFloat(accounting.formatNumber(b*i,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point))}e(".item[data-order_item_id="+t+"]").stop(!0).css("opacity","1").unblock()})},""!=setStart&&d.set("select",setStart),""!=setEnd&&r.set("select",setEnd)}})})}(jQuery);