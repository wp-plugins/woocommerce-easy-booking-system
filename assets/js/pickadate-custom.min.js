!function(e){e(document).ready(function(){function t(e,t){var r=i(e);t>0?(endFirstDay=parseInt(r)+parseInt(t),"days"===s&&(endFirstDay-=1)):endFirstDay="nights"===s?parseInt(r)+1:r,0>=r&&(r=!1),endFirstDay<=0&&(endFirstDay=!1);var n=a(!1,r),d=a(!1,endFirstDay),l=a("infinity"),p=a(),_=a(new Date(p.year,p.month,1));return c.clear=null,c.select=void 0,c.min=n,c.max=l,c.highlight=p,c.view=_,pickerStart.$node.val(""),o.clear=null,o.select=void 0,o.min=d,o.max=l,o.highlight=p,o.view=_,pickerEnd.$node.val(""),!1}function a(e,t){if(!e)var e=new Date;if(t&&e.setDate(e.getDate()+t),"infinity"===e){var a={date:1/0,day:1/0,month:1/0,obj:1/0,pick:1/0,year:1/0};return a}e.setHours(0,0,0,0);var a={date:e.getDate(),day:e.getDay(),month:e.getMonth(),obj:e,pick:e.getTime(),year:e.getFullYear()};return a}function i(e){var t=+e;return t}$input=e(".datepicker").pickadate({formatSubmit:"yyyy-mm-dd"}),$inputStart=e(".datepicker_start").pickadate(),$inputEnd=e(".datepicker_end").pickadate(),pickerStart=$inputStart.pickadate("picker"),pickerEnd=$inputEnd.pickadate("picker");var r,n,c=pickerStart.component.item,o=pickerEnd.component.item,d=ajax_object.product_type,s=ajax_object.calc_mode,l=!1;if("simple"===d){{var n=ajax_object.first_date,r=ajax_object.min;ajax_object.max}t(n,r),e("body").trigger("pickers_init"),pickerStart.render(),pickerEnd.render(),e("body").trigger("after_pickers_init")}if("variable"===d){var p=e(".wceb_picker_wrap");p.hide(),e(".price").find(".wceb-price-format").hide(),e("body").on("found_variation",".variations_form",function(a,i){i.is_purchasable&&i.is_in_stock&&i.variation_is_visible&&i.is_bookable?(p.slideDown(200),variationId=i.variation_id,n=ajax_object.first_date[variationId],r=ajax_object.min[variationId],t(n,r),e("body").trigger("pickers_init",[i]),pickerStart.render(),pickerEnd.render(),e("body").trigger("after_pickers_init",[i]),e(".price").find(".wceb-price-format").show()):(p.hide(),e(".price").find(".wceb-price-format").hide())}),e("body").on("reset_image",".variations_form",function(){p.hide()})}ebs_clear_booking_session=function(){if(l){var t={action:"clear_booking_session"};e.post(ajax_object.ajax_url,t,function(e){l=e})}},ebs_get_min_and_max=function(t,a){var r=new Date(t.year,t.month,t.date),c=new Date(t.year,t.month,t.date);if("variable"===d)var o=e(".variations_form").find("input.variation_id").val(),s=parseInt(ajax_object.min[o]),l=parseInt(ajax_object.max[o]);else var s=parseInt(ajax_object.min),l=parseInt(ajax_object.max);var p=ajax_object.calc_mode;"plus"===a?(0==s?"nights"===p&&(s+=1):"days"===p&&(s-=1),0==l&&(l-=1),"days"===p&&(l-=1)):0==l?(r=new Date,0!=s&&(l=s,l-=1),s=1,"nights"===p&&(s-=1,l+=1)):(temp=s,s=l,l=temp,0!=temp&&(l-=1),"days"===p?s-=1:l+=1),"plus"===a?(r.setDate(r.getDate()+s),c.setDate(c.getDate()+l)):(r.setDate(r.getDate()-s),c.setDate(c.getDate()-l));var _=new Date,m=i(n);0!=m&&_.setDate(_.getDate()+m),_>r&&(r=_),0>l&&(c=!1);var u={};return u.min=r,u.max=c,u},getAdditionalCosts=function(){var t=0;return e("form.cart").find(".addon").each(function(){var a=0;e(this).is(".addon-custom-price")?a=e(this).val():e(this).is(".addon-input_multiplier")?(isNaN(e(this).val())||""==e(this).val()?(e(this).val(""),e(this).closest("p").find(".addon-alert").show()):(""!=e(this).val()&&e(this).val(Math.ceil(e(this).val())),e(this).closest("p").find(".addon-alert").hide()),a=e(this).data("price")*e(this).val()):e(this).is(".addon-checkbox, .addon-radio")?e(this).is(":checked")&&(a=e(this).data("price")):e(this).is(".addon-select")?e(this).val()&&(a=e(this).find("option:selected").data("price")):e(this).val()&&(a=e(this).data("price")),a||(a=0),t+=a}),t},ebs_set_price=function(t,a,i,r){product_id="variable"===d?e("input[name=product_id]").val():e("input[name=add-to-cart]").val(),variation_id=e(".variations_form").find("input.variation_id").val();{var n=getAdditionalCosts(),c={action:"add_new_price",product_id:product_id,variation_id:variation_id,start:i,end:r,start_format:t,end_format:a,additional_cost:n};window.location.toString()}e("form.cart").fadeTo("400","0.6").block({message:null,overlayCSS:{background:"transparent",backgroundSize:"16px 16px",opacity:.6}}),e.post(ajax_object.ajax_url,c,function(t){e(".woocommerce-error, .woocommerce-message").remove(),fragments=t.fragments,errors=t.errors,errors&&e.each(errors,function(t,a){e(t).replaceWith(a)}),fragments&&e.each(fragments,function(t,a){e(t).replaceWith(a)}),e("form.cart").trigger("update_price",[c,t]),e("form.cart").stop(!0).css("opacity","1").unblock(),l=fragments.session})},pickerStart.on({render:function(){pickerStart.$root.find(".picker__header").prepend('<div class="picker__title">'+ajax_object.start_text+"</div>")},set:function(t){var c=pickerEnd.component.item,o=pickerStart.get("select"),d=pickerEnd.get("select");if("undefined"!=typeof t.clear&&null==t.clear){var l=i(n)+parseInt(r);"nights"===s&&0==r&&0!=l&&(l+=1),0==l&&"nights"===s&&(l=1),"days"===s&&r>0&&0!=l&&(l-=1);var p=a(!1,l),_=a("infinity"),m=a(new Date(p.year,p.month,1));c.disable=[],c.min=p,c.max=_,null==d&&(c.highlight=p,c.view=m),e("body").trigger("clear_start_picker",c),pickerEnd.render(),ebs_clear_booking_session()}if(!t.select||"undefined"==typeof t.select)return!1;startPick=t.select,startDate=pickerStart.get("select","yyyy-mm-dd"),disabledDate=pickerStart.get("select"),startDateDisplay=pickerStart.get("select","dd mmmm yyyy"),"object"==typeof startPick&&(startPick=t.select.pick);var u=ebs_get_min_and_max(disabledDate,"plus"),p=u.min,_=u.max;_||(_="infinity");var p=a(p),_=a(_),m=a(new Date(p.year,p.month,1));c.min=p,c.max=_,null==d&&(c.highlight=p,c.view=m),e("body").trigger("set_start_picker",[c,startPick]),pickerEnd.render(),null!=o&&null!=d&&ebs_set_price(startDate,endDate,d,endDateDisplay)},close:function(){e(document.activeElement).blur();var t=pickerStart.get("select"),a=pickerEnd.get("select");null!=t&&null==a&&setTimeout(function(){pickerEnd.open()},250)}}),pickerEnd.on({render:function(){pickerEnd.$root.find(".picker__header").prepend('<div class="picker__title">'+ajax_object.end_text+"</div>")},set:function(t){var r=pickerStart.get("select"),o=pickerEnd.get("select");if("undefined"!=typeof t.clear&&null==t.clear){var d=i(n),s=a(!1,d),l=a("infinity");highlight=a(),_=a(new Date(highlight.year,highlight.month,1)),c.disable=[],c.min=s,c.max=l,null==r&&(c.highlight=highlight,c.view=_),e("body").trigger("clear_end_picker",c),pickerStart.render(),ebs_clear_booking_session()}if(!t.select||"undefined"==typeof t.select)return!1;endPick=t.select,endDate=pickerEnd.get("select","yyyy-mm-dd"),disabledEndDate=pickerEnd.get("select"),endDateDisplay=pickerEnd.get("select","dd mmmm yyyy"),"object"==typeof endPick&&(endPick=t.select.pick);var p=ebs_get_min_and_max(disabledEndDate,"minus"),s=p.min,l=p.max;l||(l="infinity");var s=a(s),l=a(l),_=a(new Date(s.year,s.month,1));c.min=s,c.max=l,null==r&&(c.highlight=s,c.view=_),e("body").trigger("set_end_picker",[c,endPick]),pickerStart.render(),null!=r&&null!=o&&ebs_set_price(startDate,endDate,startDateDisplay,endDateDisplay)},close:function(){e(document.activeElement).blur()}}),e("body").on("updated_addons",function(){if("variable"===d)var t=e(".variations_form").find("input.variation_id").val(),a=parseInt(ajax_object.product_price[t]);else var a=parseInt(ajax_object.product_price);var i=getAdditionalCosts(),r=parseFloat(i+a);i>0&&(pickerStart.clear(),pickerEnd.clear());var n=accounting.formatMoney(r,{symbol:ajax_object.currency_format_symbol,decimal:ajax_object.currency_format_decimal_sep,thousand:ajax_object.currency_format_thousand_sep,precision:ajax_object.currency_format_num_decimals,format:ajax_object.currency_format});"variable"===d?e(".single_variation .price .amount").html(n):e("p.booking_price .price .amount").html(n)})})}(jQuery);