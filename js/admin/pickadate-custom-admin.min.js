(function(e){e(document).ready(function(){var t=e("body").on("click",".edit-order-item",function(){var t=e(this).closest("tr");var n=t.find(".datepicker");var r=t.find(".variation_id");if(n.length&&r.length){$input=n.pickadate({min:true,close:"",formatSubmit:"yyyy-mm-dd"});setStartOnLoad=false;setEndOnLoad=false;var i=r.data("item_id"),s=e(".datepicker_start--"+i).pickadate(),o=e(".datepicker_end--"+i).pickadate(),u=$input.pickadate("picker"),a=s.pickadate("picker"),f=o.pickadate("picker");setStart=e(".datepicker_start--"+i).data("value"),setEnd=e(".datepicker_end--"+i).data("value");a.on({set:function(e){if(typeof e.clear!="undefined"&&e.clear==null){f.set("disable",false,{muted:true}).set("max",false,{muted:true}).set("highlight",new Date,{muted:true});startPick=undefined;ebs_clear_booking_session()}else{startPick=e.select}if(e.select&&typeof e.select!="undefined"){startPickerData={startDate:a.get("select","yyyy-mm-dd"),disabledDate:a.get("select"),startDateDisplay:a.get("select","dd mmmm yyyy")};f.set("disable",false,{muted:true});if(order_ajax_info.calc_mode=="days"){f.set("disable",[{from:true,to:[startPickerData.disabledDate.year,startPickerData.disabledDate.month,startPickerData.disabledDate.date-1]}],{muted:true})}else{f.set("disable",[{from:true,to:[startPickerData.disabledDate.year,startPickerData.disabledDate.month,startPickerData.disabledDate.date]}],{muted:true})}if(setStart=="")setStartOnLoad=true;if(typeof startPick!="undefined"&&typeof endPick!="undefined"&&setStartOnLoad==true&&setEndOnLoad==true)ebs_set_price(i,startPickerData,endPickerData);if(setStart!="")setStartOnLoad=true}}});f.on({set:function(e){if(typeof e.clear!="undefined"&&e.clear==null){a.set("disable",false,{muted:true}).set("max",false,{muted:true}).set("highlight",new Date,{muted:true});endPick=undefined;ebs_clear_booking_session()}else{endPick=e.select}if(e.select&&typeof e.select!="undefined"){endPickerData={endDate:f.get("select","yyyy-mm-dd"),disabledEndDate:f.get("select"),endDateDisplay:f.get("select","dd mmmm yyyy")};if(order_ajax_info.calc_mode=="days"){a.set("max",[endPickerData.disabledEndDate.year,endPickerData.disabledEndDate.month,endPickerData.disabledEndDate.date],{muted:true})}else{a.set("max",[endPickerData.disabledEndDate.year,endPickerData.disabledEndDate.month,endPickerData.disabledEndDate.date-1],{muted:true})}if(setEnd=="")setEndOnLoad=true;if(typeof startPick!="undefined"&&typeof endPick!="undefined"&&setStartOnLoad==true&&setEndOnLoad==true)ebs_set_price(i,startPickerData,endPickerData);if(setEnd!="")setEndOnLoad=true}}});ebs_clear_booking_session=function(){var t={action:"clear_booking_session"};e.post(order_ajax_info.ajax_url,t)};ebs_set_price=function(t,n,r){var i=e('.quantity[name="order_item_qty['+t+']"]'),s=i.val(),o=i.attr("data-qty");var u={action:"ebs_sku_order_update_product_dates",order_id:order_ajax_info.order_id,item_id:t,quantity:s,start:n.startDateDisplay,end:r.endDateDisplay,start_format:n.startDate,end_format:r.endDate};e(".item[data-order_item_id="+t+"]").fadeTo("400","0.6").block({message:null,overlayCSS:{background:"transparent url("+woocommerce_admin_meta_boxes.plugin_url+"/assets/images/ajax-loader.gif) no-repeat center",backgroundSize:"16px 16px",opacity:.6}});e.post(order_ajax_info.ajax_url,u,function(n){var r=e('.line_total[name="line_total['+t+']"]'),i=e('.line_subtotal[name="line_subtotal['+t+']"]'),u=e('.line_tax[name="line_tax['+t+'][1]"]'),a=e('.line_subtotal_tax[name="line_subtotal_tax['+t+'][1]"]');var f=accounting.unformat(n.total,woocommerce_admin.mon_decimal_point);var l=accounting.unformat(f/o,woocommerce_admin.mon_decimal_point);r.val(parseFloat(accounting.formatNumber(l*s,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point));var c=accounting.unformat(n.subtotal,woocommerce_admin.mon_decimal_point);var h=accounting.unformat(c/o,woocommerce_admin.mon_decimal_point);i.val(parseFloat(accounting.formatNumber(h*s,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point));if(n.tax_total&&typeof n.tax_total!="undefined"){var p=accounting.unformat(n.tax_total[1],woocommerce_admin.mon_decimal_point);var d=accounting.unformat(p/o,woocommerce_admin.mon_decimal_point);if(0<d){u.val(parseFloat(accounting.formatNumber(d*s,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point))}}if(n.tax_subtotal&&typeof n.tax_subtotal!="undefined"){var v=accounting.unformat(n.tax_subtotal[1],woocommerce_admin.mon_decimal_point);var m=accounting.unformat(v/o,woocommerce_admin.mon_decimal_point);if(0<m){a.val(parseFloat(accounting.formatNumber(m*s,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point))}}e(".item[data-order_item_id="+t+"]").stop(true).css("opacity","1").unblock()})};if(setStart!="")a.set("select",setStart);if(setEnd!="")f.set("select",setEnd)}})})})(jQuery)