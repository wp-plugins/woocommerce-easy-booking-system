(function(e){e(document).ready(function(){firstDay=+ajax_object.first_date;if(firstDay==0)firstDay=true;$input=e(".datepicker").pickadate({min:firstDay,close:"",formatSubmit:"yyyy-mm-dd"});$inputStart=e(".datepicker_start").pickadate();$inputEnd=e(".datepicker_end").pickadate();picker=$input.pickadate("picker");pickerStart=$inputStart.pickadate("picker");pickerEnd=$inputEnd.pickadate("picker");pickerStart.on({set:function(e){if(typeof e.clear!="undefined"&&e.clear==null){pickerEnd.set("disable",false,{muted:true}).set("max",false,{muted:true}).set("highlight",new Date,{muted:true});startPick=undefined;ebs_clear_booking_session()}if(e.select&&typeof e.select!="undefined"){startPick=e.select;startDate=pickerStart.get("select","yyyy-mm-dd");var t=pickerStart.get("select");startDateDisplay=pickerStart.get("select","dd mmmm yyyy");if(typeof startPick==="object"){startPick=e.select.pick}var n=ebs_get_min_and_max(t,"plus");var r=n.min;var i=n.max;pickerEnd.set("disable",false,{muted:true}).set("max",false,{muted:true}).set("highlight",r,{muted:true});if(ajax_object.calc_mode=="days"){pickerEnd.set("disable",[{from:true,to:[t.year,t.month,t.date-1]},{from:[t.year,t.month,t.date],to:r}],{muted:true}).set("max",i,{muted:true})}else{pickerEnd.set("disable",[{from:true,to:[t.year,t.month,t.date]},{from:[t.year,t.month,t.date],to:r}],{muted:true}).set("max",i,{muted:true})}if(typeof startPick!="undefined"&&typeof endPick!="undefined")ebs_set_price(startPick,endPick,startDate,endDate,startDateDisplay,endDateDisplay)}else{return false}}});pickerEnd.on({set:function(e){if(typeof e.clear!="undefined"&&e.clear==null){pickerStart.set("disable",false,{muted:true}).set("max",false,{muted:true}).set("highlight",new Date,{muted:true});endPick=undefined;ebs_clear_booking_session()}if(e.select&&typeof e.select!="undefined"){endPick=e.select;endDate=pickerEnd.get("select","yyyy-mm-dd");var t=pickerEnd.get("select");endDateDisplay=pickerEnd.get("select","dd mmmm yyyy");if(typeof endPick==="object"){endPick=e.select.pick}var n=ebs_get_min_and_max(t,"minus");var r=n.min;var i=n.max;pickerStart.set("disable",false,{muted:true}).set("highlight",r,{muted:true});if(ajax_object.calc_mode=="days"){pickerStart.set("disable",[{from:true,to:r}],{muted:true}).set("max",i,{muted:true})}else{pickerStart.set("disable",[{from:true,to:r}],{muted:true}).set("max",i,{muted:true})}if(typeof startPick!="undefined"&&typeof endPick!="undefined")ebs_set_price(startPick,endPick,startDate,endDate,startDateDisplay,endDateDisplay)}else{return false}}});ebs_clear_booking_session=function(){var t={action:"clear_booking_session"};e.post(ajax_object.ajax_url,t)};ebs_get_min_and_max=function(e,t){var n=new Date(e.year,e.month,e.date);var r=new Date(e.year,e.month,e.date);var i=parseInt(ajax_object.min);var s=parseInt(ajax_object.max);var o=ajax_object.calc_mode;if(t=="plus"){if(i==0){i-=1}else{i-=2;if(o=="nights")i+=1}if(s==0)s-=1;if(o=="days")s-=1}else{if(s==0){n=new Date;if(i!=0){s=i;s-=1}i=1;if(o=="nights")s+=1}else{temp=i;i=s;s=temp;if(temp!=0)s-=1;if(o=="nights"){i+=1;s+=1}}}if(t=="plus"){n.setDate(n.getDate()+i);r.setDate(r.getDate()+s)}else{n.setDate(n.getDate()-i);r.setDate(r.getDate()-s)}if(s<0)r=false;var u={};u["min"]=n;u["max"]=r;return u};ebs_set_price=function(t,n,r,i,s,o){product_id=e("#variation_id").data("product_id");variation_id=e("#variation_id").val();var u=parseInt((n-t)/864e5);if(u==0){u=1}var a={action:"add_new_price",product_id:product_id,variation_id:variation_id,days:u,start:s,end:o,start_format:r,end_format:i};var f=window.location.toString();e("form.cart").fadeTo("400","0.6").block({message:null,overlayCSS:{background:"transparent url("+woocommerce_params.ajax_loader_url+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}});e.post(ajax_object.ajax_url,a,function(t){e(".woocommerce-error, .woocommerce-message").remove();fragments=t.fragments;errors=t.errors;if(errors){e.each(errors,function(t,n){e(t).replaceWith(n)})}if(fragments){e.each(fragments,function(t,n){e(t).replaceWith(n)})}e("form.cart").stop(true).css("opacity","1").unblock()})};e(".variations_form").on("change",".variations select",function(){pickerStart.clear();pickerEnd.clear()})})})(jQuery)